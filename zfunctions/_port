#compdef port

local context state line
typeset -A opt_args

_arguments : \
  '(-d -q)-v[verbose mode]' \
  '(-v -q)-d[debug   mode]' \
  '(-v -d)-q[quiet   mode]' \
  '1:commend:((search:search
               variants:variants
               install:install
               uninstall:uninstall
               activate:activate
               deactivate:deactivate
               installed:installed
               sync:sync
               outdated:outdated
               upgrade:upgrade
               clean:clean
               list:list
               version:version
               selfupdate:selfupdate
               help:help))' \
  '*:packages:->package_list'


case ${line[1]} in
uninstall*)
  if [[ "$state" == 'package_list' ]]; then
      local installed_list
      : ${(A)installed_list::=${${${(f)"$(port -q installed 2>/dev/null)"}#  }%% *}}
      _describe -t installed_list 'installed list' installed_list
  fi
  ;;
*)
  echo -n "${(qqq)line}"
  if [[ "$state" == 'package_list' ]]; then
    local package_list
    : ${(A)package_list::=${${(f)"$(port -q list 2>/dev/null)"}%% *}}
    _describe -t package_list 'package list' package_list
  fi
  ;;
esac

# vim: ft=zsh
